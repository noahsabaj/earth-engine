<!DOCTYPE html>
<html>
<head>
    <title>WebGPU Test</title>
</head>
<body>
    <h1>WebGPU Test</h1>
    <canvas id="canvas" width="500" height="500" style="border: 1px solid white;"></canvas>
    <div id="result"></div>
    
    <script>
        async function testWebGPU() {
            const resultDiv = document.getElementById('result');
            
            try {
                // Step 1: Check if WebGPU exists
                if (!navigator.gpu) {
                    throw new Error('WebGPU not supported in this browser');
                }
                resultDiv.innerHTML += '<p style="color: green;">✓ WebGPU API found</p>';
                
                // Step 2: Request adapter
                const adapter = await navigator.gpu.requestAdapter();
                if (!adapter) {
                    throw new Error('No GPU adapter found');
                }
                resultDiv.innerHTML += '<p style="color: green;">✓ GPU adapter found</p>';
                
                // Step 3: Request device
                const device = await adapter.requestDevice();
                resultDiv.innerHTML += '<p style="color: green;">✓ GPU device created</p>';
                
                // Step 4: Configure canvas
                const canvas = document.getElementById('canvas');
                const context = canvas.getContext('webgpu');
                const format = navigator.gpu.getPreferredCanvasFormat();
                
                context.configure({
                    device: device,
                    format: format,
                });
                resultDiv.innerHTML += '<p style="color: green;">✓ Canvas configured</p>';
                
                // Step 5: Create a simple render
                const encoder = device.createCommandEncoder();
                const textureView = context.getCurrentTexture().createView();
                
                const renderPass = encoder.beginRenderPass({
                    colorAttachments: [{
                        view: textureView,
                        clearValue: { r: 0.0, g: 0.5, b: 1.0, a: 1.0 },
                        loadOp: 'clear',
                        storeOp: 'store',
                    }]
                });
                
                renderPass.end();
                device.queue.submit([encoder.finish()]);
                
                resultDiv.innerHTML += '<p style="color: green;">✓ Rendered blue color to canvas</p>';
                resultDiv.innerHTML += '<h2 style="color: green;">WebGPU is working! ✅</h2>';
                
            } catch (error) {
                resultDiv.innerHTML += `<p style="color: red;">✗ Error: ${error.message}</p>`;
                console.error(error);
            }
        }
        
        testWebGPU();
    </script>
</body>
</html>